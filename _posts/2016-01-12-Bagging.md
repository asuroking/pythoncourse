---
layout: post
title: Bagging
author: Jeremy
tags:
comments: true
---
# Bagging

## Bootstrap aggregating (bagging)

__Basic idea__:

1. Resample cases and recalculate predictions
2. Average or majority vote

__Notes__:

* Similar bias
* Reduced variance
* More useful for non-linear functions

---

## Ozone data


    %pylab inline
    import pandas as pd

    ozone=pd.read_csv('http://statweb.stanford.edu/~tibs/ElemStatLearn/datasets/ozone.data',sep='\t')
    ozone=ozone.sort('ozone')
    ozone[0:6]

    Populating the interactive namespace from numpy and matplotlib





<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ozone</th>
      <th>radiation</th>
      <th>temperature</th>
      <th>wind</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>16</th>
      <td>1</td>
      <td>8</td>
      <td>59</td>
      <td>9.7</td>
    </tr>
    <tr>
      <th>18</th>
      <td>4</td>
      <td>25</td>
      <td>61</td>
      <td>9.7</td>
    </tr>
    <tr>
      <th>13</th>
      <td>6</td>
      <td>78</td>
      <td>57</td>
      <td>18.4</td>
    </tr>
    <tr>
      <th>44</th>
      <td>7</td>
      <td>48</td>
      <td>80</td>
      <td>14.3</td>
    </tr>
    <tr>
      <th>105</th>
      <td>7</td>
      <td>49</td>
      <td>69</td>
      <td>10.3</td>
    </tr>
    <tr>
      <th>6</th>
      <td>8</td>
      <td>19</td>
      <td>61</td>
      <td>20.1</td>
    </tr>
  </tbody>
</table>
</div>



[http://en.wikipedia.org/wiki/Bootstrap_aggregating](http://en.wikipedia.org/wiki/Bootstrap_aggregating)


---

## Bagged loess


    import statsmodels.api as sm

    loessfit = pd.DataFrame(sm.nonparametric.lowess(ozone['temperature'],ozone['ozone'],frac=0.2))[[1]].T

    for i in range(10):
      selected = np.random.choice(len(ozone),len(ozone))
      loessfit = loessfit.append(pd.DataFrame(sm.nonparametric.lowess(ozone['temperature'][selected],
                                                                      ozone['ozone'][selected],frac=0.2))[[1]].T)
    loessfit=loessfit[1:]

    plot(ozone['ozone'], ozone['temperature'], '+')
    for i in range(len(loessfit)):
        plot(ozone['ozone'],np.ravel(loessfit.iloc[[i]]),color="gray")

    ylabel("temperature")
    xlabel("ozone")
    plot(ozone['ozone'], loessfit.mean(axis=0),linewidth=2.5)
    show()


![png](/assets/bagging/output_4_0.png)


---

## Bagging in scikit-learn

* Some models perform bagging for you:
  * `sklearn.ensemble.BaggingClassifier`

http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.BaggingClassifier.html


    from sklearn.ensemble import BaggingClassifier
    from sklearn.tree import DecisionTreeRegressor
    #integer error from numpy to scikit - ignore warnings here
    import warnings
    warnings.filterwarnings('ignore')

    ensemble = BaggingClassifier(base_estimator=DecisionTreeRegressor(max_leaf_nodes=8),
                                 n_estimators=10,
                                 bootstrap=True,
                                 bootstrap_features=True,
                                 oob_score=True);

    fittedmodel=ensemble.fit(ozone[['ozone']], np.ravel(ozone[['temperature']]));

    plot(ozone[['ozone']],ozone[['temperature']],'+')
    plot(ozone[['ozone']],fittedmodel.predict(ozone[['ozone']]),color="red",marker="o",linewidth=0)
    ylabel("temperature")
    xlabel("ozone")
    show()


![png](/assets/bagging/output_6_0.png)


##Parts of Bagging

See:
    http://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeRegressor.html

---

## Notes and further resources

__Notes__:

* Bagging is most useful for nonlinear models
* Often used with trees - an extension is random forests
* Several models use bagging in caret's _train_ function

__Further resources__:

* [Bagging](http://en.wikipedia.org/wiki/Bootstrap_aggregating)
* [Bagging and boosting](http://stat.ethz.ch/education/semesters/FS_2008/CompStat/sk-ch8.pdf)
* [Elements of Statistical Learning](http://www-stat.stanford.edu/~tibs/ElemStatLearn/)
