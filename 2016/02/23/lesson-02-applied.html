<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Lesson 02 Functions in Python</title>
  <meta name="description" content="Welcome to Lesson 02">

  <link rel="stylesheet" href="/pythoncourse/css/main.css">
  <link rel="canonical" href="http://jeremy.kiwi.nz/pythoncourse/pythoncourse/2016/02/23/lesson-02-applied.html">
  <link rel="alternate" type="application/rss+xml" title="Python @ Precima" href="http://jeremy.kiwi.nz/pythoncourse/pythoncourse/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/pythoncourse/">Python @ Precima</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
        
          
        
          
          <a class="page-link" href="/pythoncourse/tag/Applied%20Statistics%20stream/">Applied Statistics stream</a>
          
        
          
          <a class="page-link" href="/pythoncourse/tag/R&D%20stream/">R&D stream</a>
          
        
          
          <a class="page-link" href="/pythoncourse/tag/python/">python</a>
          
        
          
          <a class="page-link" href="/pythoncourse/tag/notebook/">notebook</a>
          
        
      </div>
    </nav>

  </div>

</header>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73837623-1', 'auto');
  ga('send', 'pageview');

</script>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Lesson 02 Functions in Python</h1>
    <p class="post-meta"><time datetime="2016-02-23T00:00:00-05:00" itemprop="datePublished">Feb 23, 2016</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremy</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="welcome-to-lesson-02">Welcome to Lesson 02</h2>

<p>Everyone should have covered the previous lessons, and the exercises. If there
are any problems with any of the exercises, please post on the forum - if there
is enough interest, we can cover a question or two in the next class.</p>

<p>I’ll go over a couple of questions from last lesson now.</p>

<p>Today we will cover functions, lambda functions, functional programming, scoping
in Python, dynamic programming and decorators. Download the <a href="/pythoncourse/assets/notebooks/applied/lesson%2002%20applied.ipynb">notebook
here</a>.</p>

<p>As an aside, this course is being developed and hosted using github - if you
want access to all the notebooks, you can find <a href="https://github.com/jeremycg/pythoncourse/tree/raw/assets/notebooks">them
here</a>. If
you know how to use git and github feel free to file an issue or pull request if
you spot a typo. If not, we will cover git later in the course.</p>

<h3 id="intro-to-functions">Intro to Functions</h3>

<p>We have already seen how to use the built-in Python functions. You can see a
list of every fucntion included in Python 3.5 <a href="https://docs.python.org/3.5/library/functions.html">here on the official Python
documentation site</a>. Today
we will learn how to create our own.</p>

<p>Functions are one of the key parts of any programming language. We can use them
when we have a chunk of code we want to reuse and don’t want to type out a lot
of times.</p>

<p>Key parts of a function are its name, the arguments, the function body, the
return statement, and the docstring.</p>

<h3 id="writing-our-first-function">Writing our first function</h3>

<p><strong>In [38]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfirstfun</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="s">'''Here is the docstring. this will be displayed to a user calling help(myfirstfun)
    It can be as long as you'd like.
    This argument takes two arguments, and returns the sum of them
    '''</span>
    <span class="k">return</span><span class="p">(</span><span class="n">arg1</span> <span class="o">+</span> <span class="n">arg2</span><span class="p">)</span>

<span class="n">help</span><span class="p">(</span><span class="n">myfirstfun</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Help on function myfirstfun in module __main__:

myfirstfun(arg1, arg2)
    Here is the docstring. this will be displayed to a user calling help(myfirstfun)
    It can be as long as you'd like.
    This argument takes two arguments, and returns the sum of them
</code></pre>
</div>

<p><strong>In [39]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">myfirstfun</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>3
</code></pre>
</div>

<p><strong>In [40]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">myfirstfun</span><span class="p">(</span><span class="s">"h"</span><span class="p">,</span> <span class="s">"i"</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>'hi'
</code></pre>
</div>

<p>We might not want our function to work on strings! We can raise an error if the
arguments are not numeric:</p>

<p><strong>In [41]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfirstfun</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="s">'''Here is the docstring. this will be displayed to a user calling help(myfirstfun)
    It can be as long as you'd like.
    This argument takes two arguments, and returns the sum of them
    '''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">,</span> <span class="s">"This function requires numerics"</span>
    <span class="k">return</span><span class="p">(</span><span class="n">arg1</span> <span class="o">+</span> <span class="n">arg2</span><span class="p">)</span>

<span class="n">myfirstfun</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>3
</code></pre>
</div>

<p><strong>In [42]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">myfirstfun</span><span class="p">(</span><span class="s">"h"</span><span class="p">,</span> <span class="s">"i"</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>---------------------------------------------------------------------------

AssertionError                            Traceback (most recent call last)

&lt;ipython-input-42-b9e7ba21c90e&gt; in &lt;module&gt;()
----&gt; 1 myfirstfun("h", "i")


&lt;ipython-input-41-f4e6512fed1f&gt; in myfirstfun(arg1, arg2)
      5     '''
      6     for i in arg1, arg2:
----&gt; 7         assert type(i) == int or type(i) == float, "This function requires numerics"
      8     return(arg1 + arg2)
      9


AssertionError: This function requires numerics
</code></pre>
</div>

<h3 id="passing-multiple-arguments-and-default-values">Passing Multiple Arguments and Default Values</h3>

<p>Some functions will need to take an unknown number of arguments, or a default
value:</p>

<p><strong>In [43]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfirstfun</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">moreargs</span><span class="p">):</span>
    <span class="s">'''
    This function takes two arguments, and returns the sum of them
    any extra arguments are printed to the screen
    '''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="c">#can also use isinstance()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"here are the extra arguments {x}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">moreargs</span><span class="p">)))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">arg1</span> <span class="o">+</span> <span class="n">arg2</span><span class="p">)</span>

<span class="n">myfirstfun</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>here are the extra arguments [3, 4, 5, 6]





3
</code></pre>
</div>

<p><strong>In [44]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">myfirstfun</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>here are the extra arguments []





12
</code></pre>
</div>

<h3 id="named-arguments">Named Arguments</h3>

<p>Python supports named arguments, unlike most languages, but similar to R:</p>

<p><strong>In [3]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfunction</span><span class="p">(</span><span class="n">customer</span><span class="p">,</span> <span class="n">basket</span><span class="p">):</span>
    <span class="k">return</span><span class="p">({</span><span class="n">customer</span><span class="p">:</span> <span class="n">basket</span><span class="p">})</span>
<span class="n">myfunction</span><span class="p">(</span><span class="n">basket</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">customer</span> <span class="o">=</span> <span class="s">"customer1"</span><span class="p">)</span>
<span class="c">#by position, expect error</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="err">'customer1':</span><span class="w"> </span><span class="err">[1,</span><span class="w"> </span><span class="err">2,</span><span class="w"> </span><span class="err">3,</span><span class="w"> </span><span class="err">4]</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>We go by name, then order</p>

<p><strong>In [46]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfunction</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">cost</span><span class="p">,</span><span class="n">weight</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">myfunction</span><span class="p">(</span><span class="s">"bananas"</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">myfunction</span><span class="p">(</span><span class="s">"oranges"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>bananas
1
5
1


oranges
3
3
1
</code></pre>
</div>

<p>We can combine named and unnamed values. Any positional arguments are passed as
a tuple, any named arguments are passed as a dictionary. We add a * to
positional, and ** to keyword arguments. Very often, we will see this
arguments denoted as *args and **kwargs, but we can name them whatever we’d
like.</p>

<p>Named arguments must go last:</p>

<p><strong>In [47]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfunction</span><span class="p">(</span><span class="o">*</span><span class="n">positional</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Positional:"</span><span class="p">,</span> <span class="n">positional</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Keywords:"</span><span class="p">,</span> <span class="n">keywords</span><span class="p">)</span>

<span class="n">myfunction</span><span class="p">(</span><span class="s">'one'</span><span class="p">,</span> <span class="s">'two'</span><span class="p">,</span> <span class="s">'three'</span><span class="p">)</span>
<span class="n">myfunction</span><span class="p">(</span><span class="s">'one'</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="s">'two'</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="s">'three'</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Positional: ('one', 'two', 'three')
Keywords: {}
Positional: ('one',)
Keywords: {'b': 'three', 'a': 'two'}
</code></pre>
</div>

<p><strong>In [48]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">myfunction</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="s">'one'</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="s">'two'</span><span class="p">,</span> <span class="s">'three'</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>  File "&lt;ipython-input-48-80cc4c5ccb1f&gt;", line 1
    myfunction(a = 'one', b = 'two', 'three')
                                    ^
SyntaxError: positional argument follows keyword argument
</code></pre>
</div>

<h3 id="warning">Warning</h3>

<p>For default values, we evaluate them at function definition - this saves time
but can lead to error when using mutable defaults</p>

<p><strong>In [10]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfunction</span><span class="p">(</span><span class="n">customer</span> <span class="o">=</span> <span class="s">"1"</span><span class="p">,</span> <span class="n">spend</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">45</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="n">customer</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spend</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunction</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunction</span><span class="p">(</span><span class="s">"2"</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="c">#only locally defined</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>1: 35184372088832
2: 4



---------------------------------------------------------------------------

NameError                                 Traceback (most recent call last)

&lt;ipython-input-10-77c7705ebe6e&gt; in &lt;module&gt;()
      3 print(myfunction())
      4 print(myfunction("2",4))
----&gt; 5 print(b) #only locally defined


NameError: name 'b' is not defined
</code></pre>
</div>

<p><strong>In [17]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfunction</span><span class="p">(</span><span class="n">item</span> <span class="o">=</span> <span class="s">"apples"</span><span class="p">,</span> <span class="n">basket</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">basket</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">basket</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">myfunction</span><span class="p">(</span><span class="s">"apples"</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunction</span><span class="p">(</span><span class="s">"bananas"</span><span class="p">))</span>
<span class="c">#extremely weird behaviour for anyone coming from R!</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>['apples']
['apples', 'bananas']
</code></pre>
</div>

<p><strong>In [18]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfunction</span><span class="p">(</span><span class="n">item</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">basket</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">basket</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">basket</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">basket</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">basket</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunction</span><span class="p">(</span><span class="s">"apples"</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunction</span><span class="p">(</span><span class="s">"bananas"</span><span class="p">))</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>['apples']
['bananas']
</code></pre>
</div>

<h3 id="closures">Closures</h3>

<p>We can do almost anything we’d like inside a function, including defining other
functions:</p>

<p><strong>In [19]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">internaldef</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">c</span> <span class="o">**</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">helper</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">helper</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="n">internaldef</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>64
</code></pre>
</div>

<p>Internal functions have access to the enclosing variables:</p>

<p><strong>In [20]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">internaldef</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">c</span> <span class="o">**</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">helper</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">helper</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="n">internaldef</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>8
</code></pre>
</div>

<p>And we can even return them.</p>

<p><strong>In [23]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">makepow</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">pown</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">num</span> <span class="o">**</span> <span class="n">a</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pown</span><span class="p">)</span>
<span class="n">pow4</span> <span class="o">=</span> <span class="n">makepow</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">pow4</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>81
</code></pre>
</div>

<p>A function defined in this manner comes with its own enclosing environment and
is termed a closure</p>

<p><strong>In [27]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">dis</span>
<span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">pow4</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>  3           0 LOAD_FAST                0 (num)
              3 LOAD_DEREF               0 (a)
              6 BINARY_POWER
              7 RETURN_VALUE
</code></pre>
</div>

<p><strong>In [40]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">pow4</span><span class="o">.</span><span class="n">__closure__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>4
</code></pre>
</div>

<p>More about this once we begin object orientated programming! For now, know that
everything in Python is an object, and we have called the _<em>closure_</em> method
on our function object to get out its values</p>

<h3 id="lambda-functions-and-map">Lambda Functions and map</h3>

<p>Lambda functions are functions which are defined and used in the same place -
they are ‘anonymous’ (see Rs version <code class="highlighter-rouge">lapply(x, function(z) z^2</code>)). They are
generally used inside another statement, where defining a function is not worth
the time.</p>

<p>We can also use the lamdba to define a function:</p>

<p><strong>In [22]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">myfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
<span class="n">myfun</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>3
</code></pre>
</div>

<p><strong>In [23]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">l</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span>
<span class="p">[</span><span class="n">myfun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>[3, 7, 11]
</code></pre>
</div>

<p><code class="highlighter-rouge">map</code> takes two arguments - a function (often a lambda function) and a sequence
(or sequences) to iterate over</p>

<p><strong>In [49]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">x</span> <span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>[1, 4, 3, 16, 5, 36]
</code></pre>
</div>

<p><strong>In [50]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">l</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>[0, 7, 16, 27, 40, 55]
</code></pre>
</div>

<p><strong>In [51]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">y</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>[6, 1, 8, 3, 10, 5]
</code></pre>
</div>

<h3 id="functional-programming--filter-any-all-and-reduce">Functional Programming : Filter, Any, All and Reduce</h3>

<p>In addition to map, several other built in functions use lambda functions, or
take functions as arguments. Python purists might say to use the more explicit
loops, but functional programming is highly optimized.</p>

<h3 id="filter">Filter</h3>

<p>Filter is used to remove certain items from a sequence:</p>

<p><strong>In [52]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">basket</span> <span class="o">=</span> <span class="p">[</span><span class="s">'oranges'</span><span class="p">,</span><span class="s">'bread'</span><span class="p">,</span><span class="s">'bananas'</span><span class="p">,</span><span class="s">'milk'</span><span class="p">]</span>
<span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s">'oranges'</span><span class="p">,</span><span class="s">'apples'</span><span class="p">,</span><span class="s">'bananas'</span><span class="p">,</span><span class="s">'kiwis'</span><span class="p">,</span><span class="s">'strawberries'</span><span class="p">,</span> <span class="s">'pears'</span><span class="p">]</span>
<span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">basket</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fruits</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="n">out</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>['oranges', 'bananas']
</code></pre>
</div>

<p><strong>In [53]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fruits</span><span class="p">,</span> <span class="n">basket</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>['oranges', 'bananas']
</code></pre>
</div>

<h3 id="any-and-all">Any and all</h3>

<p>any and all are functions which check if every (or any) member or an iterable
are True:</p>

<p><strong>In [54]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">l</span><span class="p">))</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>True
True
</code></pre>
</div>

<p>We can use them similar to generators however:</p>

<p><strong>In [55]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">basket</span> <span class="o">=</span> <span class="p">[</span><span class="s">'oranges'</span><span class="p">,</span><span class="s">'bread'</span><span class="p">,</span><span class="s">'bananas'</span><span class="p">,</span><span class="s">'milk'</span><span class="p">]</span>
<span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s">'oranges'</span><span class="p">,</span><span class="s">'apples'</span><span class="p">,</span><span class="s">'bananas'</span><span class="p">,</span><span class="s">'kiwis'</span><span class="p">,</span><span class="s">'strawberries'</span><span class="p">,</span> <span class="s">'pears'</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="ow">in</span> <span class="n">fruits</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">basket</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="ow">in</span> <span class="n">fruits</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">basket</span><span class="p">))</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>True
False
</code></pre>
</div>

<p><strong>In [56]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#empty lists have differing behaviour</span>
<span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">print</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">l</span><span class="p">))</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>False
True
</code></pre>
</div>

<h3 id="reduce">Reduce</h3>

<p>Reduce was removed from base Python in version 3.0, but remains a source of
controversy, as it is a key function in higher level programming languages. The
official advice is to use a loop:</p>

<p><strong>In [11]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">**</span><span class="n">i</span>
<span class="n">result</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>1152921504606846976
</code></pre>
</div>

<p>We can import reduce from functools:</p>

<p><strong>In [12]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="nb">reduce</span>

<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="n">y</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>1152921504606846976
</code></pre>
</div>

<p>If you can’t figure out what we’ve done, that’s one of the reasons why reduce
was removed. It works by taking a list of arguments, applying the first function
to the first two members, then to the output of that, and the next variable….</p>

<p>(((2 ** 3) ** 4) ** 5)</p>

<h3 id="call-by-reference-and-side-effects">Call by reference and side effects</h3>

<p>In programming, we have two ways of passing values into functions, calling by
reference, or calling by value. Python uses both (and calls it passing by name)!</p>

<p>Call by value uses the values of an argument, and never modifies the actual
passed value (R does this, as do most versions of SQL):</p>

<p><strong>In [25]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="mi">45</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">5</span>
    <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>50
45
</code></pre>
</div>

<p>For immutable objects, we always pass by value. Under the hood, Python keeps the
variable in the same location in memory, until we modify it (this is a
considerable speed up over copying if we pass a large object). Using the id
function, we can see what is going on:</p>

<p><strong>In [31]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="mi">45</span>
<span class="k">print</span><span class="p">(</span><span class="s">"a is at "</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"x is at "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">5</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"x is now at "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>a is at 1935078544
x is at 1935078544
a is at 1935078704
50
45
</code></pre>
</div>

<p>For mutable objects, we pass by reference and we can cause all sorts of trouble
(or desirable things). Again, this is similar to c++ pointers and can be
implemented in some SQL builds using IN OUT parameters:</p>

<p><strong>In [37]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">return</span> <span class="mi">3</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c">#a is changed! even though we didn't return it!</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>3
[1, 2, 3, 4]
</code></pre>
</div>

<p>Again, we can track ids to see what is happening under the hood:</p>

<p><strong>In [36]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">"a is at "</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"x is at "</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"x is now at "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="k">return</span> <span class="mi">3</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>a is at 2253675131528
x is at 2253675131528
x is now at 2253675131528
3
[1, 2, 3, 4]
</code></pre>
</div>

<p>Technically, we have caused a “side effect” in that we have modifed the global
environment inside a function. In functional programming langauges, this is a
major no-no. In object orientated languages, this is perfectly reasonable as
long as you are careful.</p>

<h3 id="scoping-in-python">Scoping in Python</h3>

<p>Scoping is a technical term for where and how a language searches for, and
modifies variables. Hopefully the below makes sense to you:</p>

<p><strong>In [38]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunc</span><span class="p">(</span><span class="mi">25</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>25
1
</code></pre>
</div>

<p>We have not modified the global x, as x is local to the function.
Python uses LEGB scoping rules to search for variables:</p>

<ul>
  <li>Local - is there a local definition available inside the current enclosing
environment?</li>
  <li>Enclosing - is there an enclosing defintion?</li>
  <li>Global - is there a global definition?</li>
  <li>Built-in - is there a built in definition?</li>
</ul>

<p>Here is an example:</p>

<p><strong>In [40]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="s">"x"</span>
<span class="n">a</span> <span class="o">=</span> <span class="s">"a"</span>
<span class="n">b</span> <span class="o">=</span> <span class="s">"b"</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">myfunc2</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="s">" is enclosed"</span><span class="p">)</span>
    <span class="n">myfunc2</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="s">" is local"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="s">" is global"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">abs</span><span class="p">)</span>

<span class="n">myfunc</span><span class="p">(</span><span class="s">"c"</span><span class="p">,</span> <span class="s">"d"</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>c is enclosed
d is local
x is global
&lt;built-in function abs&gt;
</code></pre>
</div>

<p>If we want to change a global variable from inside a function, we can if it is
mutable (see the above side effects section), otherwise we can use the <code class="highlighter-rouge">global</code>
command:</p>

<p><strong>In [42]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">x</span>
    <span class="n">x</span> <span class="o">/=</span> <span class="mi">10</span>
    <span class="k">return</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">myfunc</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>10
0.2
</code></pre>
</div>

<p>Again, this is causing side effects, which may or may not be desirable. Use
<code class="highlighter-rouge">global</code> with care.</p>

<p>If we are bugfixing, we can use the <code class="highlighter-rouge">globals()</code> and <code class="highlighter-rouge">locals()</code> functions to
print all the variables we can see in an environment.</p>

<h3 id="dynamic-programming-and-caching">Dynamic programming and caching</h3>

<p>Dynamic programming is a method of optimizing functions by cutting the problem
into small pieces. Here we will run through a recursive example, however many
other methods exist. I’d love to teach you guys some examples of where they
might help - however algorithms is outside the scope of the course.</p>

<p>You might recall from the initial pre test, we can create the fibonacci sequence
in a couple of ways:</p>

<p><strong>In [14]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">fibo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
    <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">counter</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fibo</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">))))</span>
<span class="k">print</span><span class="p">([</span><span class="n">fibo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)])</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>[1, 1, 2, 3, 5, 8, 13, 21, 34]
[1, 1, 2, 3, 5, 8, 13, 21, 34]
</code></pre>
</div>

<p><strong>In [19]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">fiborecur</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">fiborecur</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fiborecur</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fiborecur</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)))</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>[1, 1, 2, 3, 5, 8, 13, 21, 34]
</code></pre>
</div>

<p>The second of these is dynamic! We have made a recursive function, to do a very
simple task multiple times</p>

<p>However, let’s check the performance using %timeit</p>

<p><strong>In [65]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">timeit</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fibo</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">)))</span>
<span class="o">%</span><span class="n">timeit</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fiborecur</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">)))</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>100000 loops, best of 3: 19.3 µs per loop
1000 loops, best of 3: 457 µs per loop
</code></pre>
</div>

<p>It performs much worse! And only gets worse as we increase x. Why?</p>

<p>We can think a little about how it works - the non-recursive solution has to do
x calculations, one for each increase.</p>

<p>The recursive solution has to do 2^x calculations - each call will have two
offspring calls.</p>

<p>Can we make it better? One way is to use a dictionary to remember our outputs.</p>

<p><strong>In [17]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">fib_cache</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">def</span> <span class="nf">fiborecur2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fib_cache</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib_cache</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">fib_cache</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">fiborecur2</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fiborecur2</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fib_cache</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">fiborecur2</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">fib_cache</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>55
{0: 0, 1: 1, 2: 1, 3: 2, 4: 3, 5: 5, 6: 8, 7: 13, 8: 21, 9: 34, 10: 55}
</code></pre>
</div>

<p><strong>In [10]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">timeit</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fibo</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">)))</span>
<span class="o">%</span><span class="n">timeit</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fiborecur</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">)))</span>
<span class="o">%</span><span class="n">timeit</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fiborecur2</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">)))</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>100000 loops, best of 3: 18 µs per loop
1000 loops, best of 3: 478 µs per loop
100000 loops, best of 3: 6.04 µs per loop
</code></pre>
</div>

<p>Great! Can we generalise this method? We could create a closure:</p>

<p><strong>In [22]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">memoize</span><span class="p">(</span><span class="n">myfunction</span><span class="p">):</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">function_to_cache</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">args</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">args</span><span class="p">]</span> <span class="o">=</span> <span class="n">myfunction</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">args</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">function_to_cache</span>

<span class="n">fiborecur3</span> <span class="o">=</span> <span class="n">memoize</span><span class="p">(</span><span class="n">fiborecur</span><span class="p">)</span></code></pre></figure>

<p><strong>In [16]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">timeit</span> <span class="n">fiborecur3</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">fiborecur2</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">fiborecur</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>The slowest run took 5.62 times longer than the fastest. This could mean that an intermediate result is being cached
1000000 loops, best of 3: 342 ns per loop
The slowest run took 8.69 times longer than the fastest. This could mean that an intermediate result is being cached
1000000 loops, best of 3: 265 ns per loop
1000 loops, best of 3: 289 µs per loop
</code></pre>
</div>

<h3 id="decorators">Decorators</h3>

<p>We can modify functions in Python using decorators. This is denoted by the @
symbol:</p>

<p><strong>In [18]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@memoize</span>
<span class="k">def</span> <span class="nf">fibn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">fiborecur</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fiborecur</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

<span class="o">%</span><span class="n">timeit</span> <span class="n">fibn</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>The slowest run took 885.25 times longer than the fastest. This could mean that an intermediate result is being cached
1000000 loops, best of 3: 347 ns per loop
</code></pre>
</div>

<p>Decorators allow us to modify functions:</p>

<p><strong>In [20]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Hello "</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>

<span class="n">myfunc</span><span class="p">(</span><span class="s">"Precima"</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Hello Precima
</code></pre>
</div>

<p><strong>In [24]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">mydecorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"That's the end of class two"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@mydecorator</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Hello "</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>

<span class="n">myfunc</span><span class="p">(</span><span class="s">"Precima"</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Hello Precima
That's the end of class two
</code></pre>
</div>

<p>We will cover in more detail how decorators work towards the end of the course</p>

<h2 id="exercises">Exercises</h2>

<p>The exercises are designed to be difficult - evidence shows that leaners learn by coding,
in combination with lectures. You should be using google, stackoverflow and your colleagues
 to help with your work, and you are allocated a good amount fo time to do them.</p>

<p>With that said, if you run out of time, feel free to skip the remaining exercises,
and I will split out the advanced questions into an optional section.</p>

<ul>
  <li>
    <p>Read through the dynamic programming section that we skipped in class. Don’t worry
 too much about specifics, the main take home message is that we can return the output of the same function.</p>
  </li>
  <li>
    <p>Rewrite your loop from last lessons exercises to find if all the letter in a
string are in another string as a function. (Advance, optional) Can you think of a dynamic
programming way to remove duplicates?</p>
  </li>
  <li>
    <p>Rewrite your zip loop from last lesson exercises as a function (Write a
modification of the current zip function, to work until the longest of the
inputs)</p>
  </li>
  <li>
    <p>Make your own function for converting fahrenheit to celsius</p>
  </li>
  <li>
    <p>Update the above function to have a docstring, explaining what it does</p>
  </li>
  <li>
    <p>Update the function to only take int or floats - use an assertion</p>
  </li>
  <li>
    <p>Write a function to take an arbitrary number of unnamed arguments, and return
their sum. Make sure you have a docstring, and test for numerics.</p>
  </li>
  <li>
    <p>Modify the above argument to use <code class="highlighter-rouge">reduce</code>, Remember you need to import reduce.</p>
  </li>
  <li>
    <p>Write a function that takes an arbitrary number of named arguments, and
returns the key of those that had even numbers as their input. myfunc(a = 1, b =
2, c = 3, d = 4) should return [‘b’, ‘d’]</p>
  </li>
  <li>
    <p>Write a function to make a function to check if an item is in a list: def myfruits(fruits):
, myfruits([“apple”, ‘banana’, ‘potato’, ‘cauliflower’]) should
return [True, True, False, False]. fruits =
[‘oranges’,’apples’,’bananas’,’kiwis’,’strawberries’, ‘pears’].</p>
  </li>
  <li>
    <p>Update the above function, to generate a function which will return a single
True or False if any members of the list are present.</p>
  </li>
  <li>
    <p>Update the above function to return as above, but with a return of True when
called on an empty list: myfruits([]) will give True</p>
  </li>
  <li>
    <p>(Advanced, optional) Write a function to find the xth prime number: myprime(x)</p>
  </li>
  <li>
    <p>(Advanced, optional) Modify the above function to be recursive</p>
  </li>
  <li>
    <p>(Advanced, optional) Modify this function to be cached - does it help with performance? Why/Why
not?</p>
  </li>
</ul>

  </div>
  
      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'jeremycg';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  
</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Python @ Precima</h2>



  </div>

</footer>


  </body>

</html>
